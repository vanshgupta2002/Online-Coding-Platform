<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:35,&quot;tests&quot;:82,&quot;passes&quot;:82,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2023-05-04T16:37:46.316Z&quot;,&quot;end&quot;:&quot;2023-05-04T16:38:06.267Z&quot;,&quot;duration&quot;:19951,&quot;testsRegistered&quot;:82,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;f1e17965-712e-4d65-914f-57b78e9b6b20&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5708d84e-247d-4f4b-8490-8498d68d2c4d&quot;,&quot;title&quot;:&quot;Blog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;title&quot;:&quot;postBlog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;before each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and blog objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  blog: {},\n};\ntestBlog = new Blog(adminDB, adminJWT);\n// Importing the postBlog function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9135681-689f-477e-9639-4003f01fae69&quot;,&quot;parentUUID&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog \&quot;after each\&quot; hook in \&quot;postBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7a84404-a4e4-407e-953e-c9bb4bf9271e&quot;,&quot;parentUUID&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a blog and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should post a blog and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: type });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.blog, match.instanceOf(blog))\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Blog posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90110fe5-4215-446e-a054-811c1e18d1a2&quot;,&quot;parentUUID&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38f4476a-406a-436f-adc9-5219fa0bdbcd&quot;,&quot;parentUUID&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postBlog should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postBlog function\nawait testBlog.postBlog(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Blog posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b690451b-8f15-45fd-8309-e6e6454e1ebe&quot;,&quot;parentUUID&quot;:&quot;6f5ec57a-ea4d-47d1-97c2-ae07f3b7f74b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;90110fe5-4215-446e-a054-811c1e18d1a2&quot;,&quot;38f4476a-406a-436f-adc9-5219fa0bdbcd&quot;,&quot;b690451b-8f15-45fd-8309-e6e6454e1ebe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;title&quot;:&quot;postEditorial&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;before each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    userToken: \&quot;validToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminJWT, adminDB, and editorial objects\nadminJWT = {\n  verifyToken: stub(),\n};\nadminDB = {\n  insertOne: stub(),\n  editorials: \&quot;editorials\&quot;,\n};\ntestEditorial = new Blog(adminDB, adminJWT);\n// Importing the postEditorial function&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9e52e41-3330-4669-9e9c-d3657c40d39e&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial \&quot;after each\&quot; hook in \&quot;postEditorial\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6e8f5f9-1fea-40dd-8ef7-ab105c7e7044&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post an editorial and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should post an editorial and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;1\&quot; });\n// Stubbing adminDB.insertOne to return data\nadminDB.insertOne.returns({});\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledOnceWith(\n    adminDB.editorials,\n    match.instanceOf(editorial)\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({ success: true, message: \&quot;Editorial posted.\&quot; })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;196aabd1-0dd7-43a3-a5d1-0e47ab7bde1b&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not post an editorial and send unauthorized response for type 0&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should not post an editorial and send unauthorized response for type 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return handle and type\nadminJWT.verifyToken.returns({ handle: handle, type: \&quot;0\&quot; });\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;You are not authorized to post editorials.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9446703b-1875-4f58-8e79-2a95bd277dd4&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(\&quot;Token expired\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e8425d3-92a3-4ef2-9790-2f722724fc99&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7552bdfc-bf64-4b4e-b1be-ff80956924c6&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog postEditorial should handle other errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(\&quot;Some error\&quot;));\n// Calling the postEditorial function\nawait testEditorial.postEditorial(req, res);\n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be\n  .true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Editorial posting failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cde22932-7e08-47f7-9d7a-e582b3e6f018&quot;,&quot;parentUUID&quot;:&quot;9078150f-a2a2-40be-b680-0f86f2d5c690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;196aabd1-0dd7-43a3-a5d1-0e47ab7bde1b&quot;,&quot;9446703b-1875-4f58-8e79-2a95bd277dd4&quot;,&quot;0e8425d3-92a3-4ef2-9790-2f722724fc99&quot;,&quot;7552bdfc-bf64-4b4e-b1be-ff80956924c6&quot;,&quot;cde22932-7e08-47f7-9d7a-e582b3e6f018&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;99137bd7-8242-4cea-bfbe-4e2e18b45729&quot;,&quot;title&quot;:&quot;getBlog&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlog\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog \&quot;before each\&quot; hook in \&quot;getBlog\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {\n  body: {\n    blogId: \&quot;validBlogId1\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  findOne: stub(),\n  blog: \&quot;blog\&quot;,\n};\n// Importing the getBlogComments function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5799ecbb-9601-4169-93d1-4f1496a31dc8&quot;,&quot;parentUUID&quot;:&quot;99137bd7-8242-4cea-bfbe-4e2e18b45729&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blog comments and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog should get blog comments and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedComments = [\&quot;comment1\&quot;, \&quot;comment2\&quot;];\n// Stubbing adminDB.findOne to return data with comments\nadminDB.findOne.returns({ comments: expectedComments });\n// Calling the getBlogComments function\nawait testBlog.getBlog(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    data: { comments: expectedComments },\n    success: true,\n    message: \&quot;Data sent successfully.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0dbdebf1-aecd-40fb-b9be-c1d1b9ba277f&quot;,&quot;parentUUID&quot;:&quot;99137bd7-8242-4cea-bfbe-4e2e18b45729&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlog should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Some error\&quot;));\n// Calling the getBlogComments function\nawait testBlog.getBlog(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(\n    adminDB.blog,\n    { _id: new ObjectId(\&quot;validBlogId1\&quot;) },\n    \n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Data could not be sent due to some internal error.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;981fce9a-a223-4035-9aa6-a0be0066ab1f&quot;,&quot;parentUUID&quot;:&quot;99137bd7-8242-4cea-bfbe-4e2e18b45729&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0dbdebf1-aecd-40fb-b9be-c1d1b9ba277f&quot;,&quot;981fce9a-a223-4035-9aa6-a0be0066ab1f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b8b5a4d7-b70f-45c4-a5fa-22269beeec24&quot;,&quot;title&quot;:&quot;getBlogs&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs \&quot;before each\&quot; hook in \&quot;getBlogs\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking res object\nres = {\n  send: stub(),\n};\n// Mocking adminDB object\nadminDB = {\n  find:stub(),\n  blog: &#x27;blog&#x27;,\n};\n// Importing the getBlogs function\ntestBlog = new Blog(adminDB, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ef2c77f-c8e3-4319-8825-4c43b1ba1290&quot;,&quot;parentUUID&quot;:&quot;b8b5a4d7-b70f-45c4-a5fa-22269beeec24&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get blogs and send success response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should get blogs and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedBlogs = [&#x27;blog1&#x27;, &#x27;blog2&#x27;];\n// Stubbing adminDB.find to return data with blogs\nadminDB.find.returns(expectedBlogs);\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ data: expectedBlogs, success: true, message: &#x27;Blogs sent successfully.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;681b7e1d-c386-4068-8be8-72b16b7d8c49&quot;,&quot;parentUUID&quot;:&quot;b8b5a4d7-b70f-45c4-a5fa-22269beeec24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle error and send error response&quot;,&quot;fullTitle&quot;:&quot;Blog getBlogs should handle error and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Some error&#x27;));\n// Calling the getBlogs function\nawait testBlog.getBlogs({}, res);\n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.blog, {}, { timestamp: -1 }, { comments: 0 })).to.be.true;\nexpect(res.send.calledOnceWith({ success: false, message: &#x27;Blogs could not be sent due to some internal error.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5728161a-59f7-49bb-994b-eedce0d70e1a&quot;,&quot;parentUUID&quot;:&quot;b8b5a4d7-b70f-45c4-a5fa-22269beeec24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;681b7e1d-c386-4068-8be8-72b16b7d8c49&quot;,&quot;5728161a-59f7-49bb-994b-eedce0d70e1a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6cf1db9a-c092-4a5e-ba56-a39e62994c73&quot;,&quot;title&quot;:&quot;comment&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/blog.test.js&quot;,&quot;file&quot;:&quot;/test/blog.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;comment\&quot;&quot;,&quot;fullTitle&quot;:&quot;Blog comment \&quot;before each\&quot; hook in \&quot;comment\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  updateOne: sinon.stub(),\n  blog: &#x27;blog&#x27;,\n}\nadminJWT = {\n  verifyToken: sinon.stub(),\n};\nreq = {\n  body: {\n    userToken: &#x27;testToken&#x27;,\n    Id: &#x27;testId123445&#x27;,\n    entityType: &#x27;blog&#x27;,\n    comment: &#x27;testComment&#x27;,\n    timestamp: Date.now(),\n  },\n};\nres = {\n  send: sinon.spy(),\n};\ncomment = new Blog(adminDB, adminJWT).comment;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;28c753e4-f408-4704-9432-599d9c4f71a2&quot;,&quot;parentUUID&quot;:&quot;6cf1db9a-c092-4a5e-ba56-a39e62994c73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a comment to a blog or editorial&quot;,&quot;fullTitle&quot;:&quot;Blog comment should post a comment to a blog or editorial&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodeData = { handle: &#x27;testHandle&#x27; };\nconst updateResult = { modifiedCount: 1 };\nconst expectedComment = {\n  handle: decodeData.handle,\n  comment: req.body.comment,\n  timestamp: req.body.timestamp,\n};\nadminJWT.verifyToken.returns(decodeData);\nadminDB.updateOne.returns(updateResult);\nawait comment(req, res);\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.firstCall.args[0]).to.equal(req.body.userToken);\nexpect(adminDB.updateOne.calledOnce).to.be.true;\n// expect(adminDB.updateOne.firstCall.args[0]).to.equal(adminDB.blog);\n// expect(adminDB.updateOne.firstCall.args[1]).to.deep.equal({\n//   _id: new ObjectId(req.body.Id),\n// });\n// expect(adminDB.updateOne.firstCall.args[2]).to.deep.equal({\n//   $push: {\n//     comments: expectedComment,\n//   },\n// });\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  message: &#x27;Comment posted.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;22d43e3f-e0c2-4534-bc21-d23d2cccf70c&quot;,&quot;parentUUID&quot;:&quot;6cf1db9a-c092-4a5e-ba56-a39e62994c73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle token expired errors&quot;,&quot;fullTitle&quot;:&quot;Blog comment should handle token expired errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expiredError = new TokenExpiredError(&#x27;TokenExpiredError&#x27;);\nadminJWT.verifyToken.throws(expiredError);\nawait comment(req, res);\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: &#x27;Token has expired.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;39c1a890-b770-45b3-8a8b-b6c1c9ae5b58&quot;,&quot;parentUUID&quot;:&quot;6cf1db9a-c092-4a5e-ba56-a39e62994c73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors&quot;,&quot;fullTitle&quot;:&quot;Blog comment should handle other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = &#x27;Error posting comment&#x27;;\nadminDB.updateOne = sinon.stub().throws(new Error(errorMessage));\nadminJWT.verifyToken.returns({ handle: &#x27;testHandle&#x27; });\nawait comment(req, res);\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: &#x27;Comment cannot be posted due to internal error.&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dbc0640c-9dea-42c1-9065-5ba8251e6f02&quot;,&quot;parentUUID&quot;:&quot;6cf1db9a-c092-4a5e-ba56-a39e62994c73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;22d43e3f-e0c2-4534-bc21-d23d2cccf70c&quot;,&quot;39c1a890-b770-45b3-8a8b-b6c1c9ae5b58&quot;,&quot;dbc0640c-9dea-42c1-9065-5ba8251e6f02&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a949ff15-0b5b-4ad5-8008-c88e2ee8c72a&quot;,&quot;title&quot;:&quot;database&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d805c733-f36a-4d80-b6dc-4417c9b070c1&quot;,&quot;title&quot;:&quot;connect&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;before each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();  \ntestDatabase = new database(uri,databaseName);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b98c30b2-4814-4465-a647-0ac115396e5a&quot;,&quot;parentUUID&quot;:&quot;d805c733-f36a-4d80-b6dc-4417c9b070c1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;fullTitle&quot;:&quot;database connect \&quot;after each\&quot; hook in \&quot;connect\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90792c28-0a61-47f1-beed-97a0f34c28f7&quot;,&quot;parentUUID&quot;:&quot;d805c733-f36a-4d80-b6dc-4417c9b070c1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should connect to the database&quot;,&quot;fullTitle&quot;:&quot;database connect should connect to the database&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const consoleSpy = spy(console,\&quot;log\&quot;);\nconst dbMock = {collection : stub()} // mock database collection\nconst clientMock = {\n    connect : stub().resolves() //returns a resolved promise (Which stimulates the condition when database is connected)\n, db : stub().returns(dbMock)}; //returns a mock database\ntestDatabase.client = clientMock;\nawait testDatabase.connect();\nexpect(clientMock.connect.calledOnce).to.be.true;\nexpect(consoleSpy.calledOnce).to.be.true;\nexpect(consoleSpy.firstCall.args[0]).to.equal(\&quot;DB Connection successful\&quot;);\nexpect(clientMock.db.calledWith(databaseName)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Users\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;otp\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Problems\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Blogs\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Editorials\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;SubmittedSolutions\&quot;)).to.be.true;\nexpect(dbMock.collection.calledWith(\&quot;Solved\&quot;)).to.be.true;\nconsoleSpy.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;06713b72-33f8-4826-93d6-b5261c69a961&quot;,&quot;parentUUID&quot;:&quot;d805c733-f36a-4d80-b6dc-4417c9b070c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;06713b72-33f8-4826-93d6-b5261c69a961&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3389972c-35db-46c9-b858-5f1efbf3467e&quot;,&quot;title&quot;:&quot;findOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;before each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6f6e1908-47a4-4b50-8e74-c735ce4b5677&quot;,&quot;parentUUID&quot;:&quot;3389972c-35db-46c9-b858-5f1efbf3467e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database findOne \&quot;after each\&quot; hook in \&quot;findOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c575075-384a-4811-98f4-67fd60c907d5&quot;,&quot;parentUUID&quot;:&quot;3389972c-35db-46c9-b858-5f1efbf3467e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database findOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nawait testDatabase.users.insertOne(doc);\n      \n// Call the findOne function with the query object\nconst query = { name: &#x27;user&#x27; };\nconst fields = { age:21, _id:0 };\nconst result = await testDatabase.findOne(testDatabase.users, query, fields);\n      \n// Assert that the result matches the expected document\nexpect (result).to.be.an(&#x27;object&#x27;);\n  expect (result).to.deep.equal({ age:21 });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67a3b26c-2db0-455d-834b-43f9ef6fb1ea&quot;,&quot;parentUUID&quot;:&quot;3389972c-35db-46c9-b858-5f1efbf3467e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;67a3b26c-2db0-455d-834b-43f9ef6fb1ea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3874ba1e-1adb-411b-a693-f4e906a872ea&quot;,&quot;title&quot;:&quot;insertOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;before each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ecad827-abad-4f4d-b9cc-81bcf5de5be7&quot;,&quot;parentUUID&quot;:&quot;3874ba1e-1adb-411b-a693-f4e906a872ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database insertOne \&quot;after each\&quot; hook in \&quot;insertOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6635d545-1fd7-4af9-84ac-28210e870f70&quot;,&quot;parentUUID&quot;:&quot;3874ba1e-1adb-411b-a693-f4e906a872ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should insert a document&quot;,&quot;fullTitle&quot;:&quot;database insertOne should insert a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21 };\nlet insertData = await testDatabase.insertOne(testDatabase.users,doc);\n  // Assert that the result matches the expected document\nexpect (insertData.acknowledged).to.equal(true);\nexpect (insertData.insertedId).to.not.equal(null | undefined);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;deab6e5d-3b70-4380-9be8-82066edb78c3&quot;,&quot;parentUUID&quot;:&quot;3874ba1e-1adb-411b-a693-f4e906a872ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;deab6e5d-3b70-4380-9be8-82066edb78c3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a3fa0042-6dd3-4437-80b2-e21683eff2b3&quot;,&quot;title&quot;:&quot;updateOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;before each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2eb53e74-8835-457c-81ab-ae974f4d44bd&quot;,&quot;parentUUID&quot;:&quot;a3fa0042-6dd3-4437-80b2-e21683eff2b3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database updateOne \&quot;after each\&quot; hook in \&quot;updateOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;29a37dc5-cba5-4e53-9119-6df0f3f1c215&quot;,&quot;parentUUID&quot;:&quot;a3fa0042-6dd3-4437-80b2-e21683eff2b3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a document&quot;,&quot;fullTitle&quot;:&quot;database updateOne should return a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21,hobby : []};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.updateOne(testDatabase.users, query, {$set : {name: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);\nquery = { name: &#x27;newUser&#x27; };\nresult = await testDatabase.updateOne(testDatabase.users, query, {$push : {hobby: \&quot;newUser\&quot;}});\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.modifiedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96eb2f0c-8b7e-4ae5-8266-6eef7fb89eb8&quot;,&quot;parentUUID&quot;:&quot;a3fa0042-6dd3-4437-80b2-e21683eff2b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;96eb2f0c-8b7e-4ae5-8266-6eef7fb89eb8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2e4d3c88-659c-4c2f-b2aa-8943e3a3e0f1&quot;,&quot;title&quot;:&quot;deleteOne&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;before each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;mongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b756b14d-4d28-44b7-bc8b-d0bb9d6e4fe7&quot;,&quot;parentUUID&quot;:&quot;2e4d3c88-659c-4c2f-b2aa-8943e3a3e0f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;fullTitle&quot;:&quot;database deleteOne \&quot;after each\&quot; hook in \&quot;deleteOne\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.disconnect();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0edc9ad0-9bf2-4310-a33b-68f4fee59e2d&quot;,&quot;parentUUID&quot;:&quot;2e4d3c88-659c-4c2f-b2aa-8943e3a3e0f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should delete a document&quot;,&quot;fullTitle&quot;:&quot;database deleteOne should delete a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Insert a document into the collection for testing\nconst doc = { name: &#x27;user&#x27;, age: 21};\nawait testDatabase.users.insertOne(doc);\n    \n// Call the findOne function with the query object\nlet query = { name: &#x27;user&#x27; };\nlet result = await testDatabase.deleteOne(testDatabase.users, query);\nexpect(result).to.be.an(&#x27;object&#x27;);\nexpect(result.acknowledged).to.equal(true);\nexpect(result.deletedCount).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b124d853-1975-4ecb-bccd-75318a5d62d5&quot;,&quot;parentUUID&quot;:&quot;2e4d3c88-659c-4c2f-b2aa-8943e3a3e0f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b124d853-1975-4ecb-bccd-75318a5d62d5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;title&quot;:&quot;find&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;before all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21 },\n  { name: &#x27;user2&#x27;, age: 22 },\n  { name: &#x27;user3&#x27;, age: 23 },\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fc17be9b-2e3b-48b9-b0e0-5d30fbd9a17e&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;fullTitle&quot;:&quot;database find \&quot;after all\&quot; hook in \&quot;find\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c5088abb-d90f-4f6a-b30a-20353cb4488e&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should find all documents in the collection&quot;,&quot;fullTitle&quot;:&quot;database find should find all documents in the collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users);\nexpect(docs).to.have.lengthOf(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;06173e72-2ea0-468d-b018-1b2174654724&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should find documents with a query object&quot;,&quot;fullTitle&quot;:&quot;database find should find documents with a query object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, { name: &#x27;user1&#x27; });\nexpect(docs).to.have.lengthOf(1);\nexpect(docs[0].name).to.equal(&#x27;user1&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3776223-08bf-4241-85b2-f1a58edde35d&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should sort documents with a sort object&quot;,&quot;fullTitle&quot;:&quot;database find should sort documents with a sort object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, { age: -1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.equal(&#x27;user3&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99e41890-f9d0-42d8-8107-4507df18e35e&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should project documents with a fields object&quot;,&quot;fullTitle&quot;:&quot;database find should project documents with a fields object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.find(testDatabase.users, {}, {}, { name: 1 });\nexpect(docs).to.have.lengthOf(3);\nexpect(docs[0].name).to.exist;\nexpect(docs[0].age).to.not.exist;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1ac16aaa-e7e7-4f87-ab18-92c4a81835fc&quot;,&quot;parentUUID&quot;:&quot;faebaaf2-950e-4e5c-9cf9-af77c07c1e0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;06173e72-2ea0-468d-b018-1b2174654724&quot;,&quot;e3776223-08bf-4241-85b2-f1a58edde35d&quot;,&quot;99e41890-f9d0-42d8-8107-4507df18e35e&quot;,&quot;1ac16aaa-e7e7-4f87-ab18-92c4a81835fc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f871d252-67fa-4bfd-a9ef-a395add6e108&quot;,&quot;title&quot;:&quot;update&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/database.test.js&quot;,&quot;file&quot;:&quot;/test/database.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;before all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create a test collection and insert some documents\nmongoserver = await MongoMemoryServer.create();\nuri = mongoserver.getUri();\nlet databaseName = \&quot;test\&quot;;\ntestDatabase = new database(uri,databaseName);\nawait testDatabase.client.connect();\ntestDatabase.users = testDatabase.client.db(testDatabase.database).collection(&#x27;users&#x27;);\nawait testDatabase.users.insertMany([\n  { name: &#x27;user1&#x27;, age: 21,hobby:[] },\n  { name: &#x27;user2&#x27;, age: 22 ,hobby:[]},\n  { name: &#x27;user3&#x27;, age: 23 ,hobby:[]},\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;148705d1-013d-4a38-8f0c-332eb14028a5&quot;,&quot;parentUUID&quot;:&quot;f871d252-67fa-4bfd-a9ef-a395add6e108&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;fullTitle&quot;:&quot;database update \&quot;after all\&quot; hook in \&quot;update\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await testDatabase.client.close();\n  await mongoserver.stop();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56d8fb18-875f-4af0-a573-e5400aca953d&quot;,&quot;parentUUID&quot;:&quot;f871d252-67fa-4bfd-a9ef-a395add6e108&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should set some values to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should set some values to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, {  }, { $set: { age:50 } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65be206c-a18b-4f33-b422-31ebde36870a&quot;,&quot;parentUUID&quot;:&quot;f871d252-67fa-4bfd-a9ef-a395add6e108&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should push values in ana array to all the documents with the required filter&quot;,&quot;fullTitle&quot;:&quot;database update should push values in ana array to all the documents with the required filter&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const docs = await testDatabase.update(testDatabase.users, { age: {$gt:21} }, { $push: { hobby:\&quot;newHobby\&quot; } });\nexpect(docs.modifiedCount).to.equal(3);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;224cc51a-ccf0-47ee-8ace-04de6b3d093c&quot;,&quot;parentUUID&quot;:&quot;f871d252-67fa-4bfd-a9ef-a395add6e108&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;65be206c-a18b-4f33-b422-31ebde36870a&quot;,&quot;224cc51a-ccf0-47ee-8ace-04de6b3d093c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6d0900be-d2f8-4c42-aea6-d35ee549d4cc&quot;,&quot;title&quot;:&quot;Email&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e6d38774-8a6b-49e5-816a-546580c5c0ba&quot;,&quot;title&quot;:&quot;sendMail&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;before each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;314163cf-70f1-4668-8bdb-14838bb77839&quot;,&quot;parentUUID&quot;:&quot;e6d38774-8a6b-49e5-816a-546580c5c0ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendMail \&quot;after each\&quot; hook in \&quot;sendMail\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2bf3dd77-526d-4c29-a2b1-a014bbf8ba1d&quot;,&quot;parentUUID&quot;:&quot;e6d38774-8a6b-49e5-816a-546580c5c0ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an email&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should send an email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// to track the sendMail function of the email.transporter\nconst sendMailSpy = sinon.spy(email.transporter, \&quot;sendMail\&quot;);\nconst receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst subject = \&quot;Test Email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\n// call the sendMail function of the email class\nemail.sendMail(receiver, subject, text);\nexpect(sendMailSpy.calledOnce).to.be.true;\nexpect(sendMailSpy.firstCall.args[0]).to.deep.equal({\n  from: email.sender,\n  to: receiver,\n  subject: subject,\n  text: text,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e24ea218-face-4017-8791-0814cc9a86aa&quot;,&quot;parentUUID&quot;:&quot;e6d38774-8a6b-49e5-816a-546580c5c0ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw the error if the email fails to send&quot;,&quot;fullTitle&quot;:&quot;Email sendMail should throw the error if the email fails to send&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// mock the sendMail function of the email.transporter\nemail.transporter.sendMail = sinon\n  .stub()\n  .yields(\&quot;Failed to send email.\&quot;);\n  // to call the callback function of the sendMail function with the error message\nconst receiver = \&quot;recipient@example.com\&quot;;\nconst subject = \&quot;Test email\&quot;;\nconst text = \&quot;This is a test email.\&quot;;\nconst errorMessage = \&quot;Failed to send email.\&quot;;\nexpect(() =&gt; {\n  email.sendMail(receiver, subject, text);\n}).to.throw(Error, errorMessage);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a8dcb39-f6ca-4790-a517-65347d99a05d&quot;,&quot;parentUUID&quot;:&quot;e6d38774-8a6b-49e5-816a-546580c5c0ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e24ea218-face-4017-8791-0814cc9a86aa&quot;,&quot;8a8dcb39-f6ca-4790-a517-65347d99a05d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5808e762-9012-4281-b3bb-74c5ff54147b&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/email.test.js&quot;,&quot;file&quot;:&quot;/test/email.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;transporter = nodemailer.createTransport(nodemailerMock());\nemail = new Email();\nemail.transporter = transporter;\nemail.sender = \&quot;test92.test@gmail.com\&quot;;\nemail.sendMail = sinon.stub().resolves();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f369c1d7-26ee-43fc-bfc4-fa8eb3af634d&quot;,&quot;parentUUID&quot;:&quot;5808e762-9012-4281-b3bb-74c5ff54147b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP \&quot;after each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4aac5606-7c10-439c-9d47-97f9dff7b855&quot;,&quot;parentUUID&quot;:&quot;5808e762-9012-4281-b3bb-74c5ff54147b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send an OTP&quot;,&quot;fullTitle&quot;:&quot;Email sendOTP should send an OTP&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const receiver = \&quot;nish95.sha@gmail.com\&quot;;\nconst otp = \&quot;123456\&quot;;\nemail.sendOTP(receiver, otp);\nexpect(\n  email.sendMail.calledOnceWithExactly(\n    receiver,\n    \&quot;OTP\&quot;,\n    `Your OTP is ${otp}`\n  )\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77acb208-0d62-44d8-a895-762bf63634e0&quot;,&quot;parentUUID&quot;:&quot;5808e762-9012-4281-b3bb-74c5ff54147b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;77acb208-0d62-44d8-a895-762bf63634e0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b078f8e1-7064-459a-aff4-83ad74e07bae&quot;,&quot;title&quot;:&quot;Problems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;44c4125b-7d46-4960-9eaa-44d1b1e8c41b&quot;,&quot;title&quot;:&quot;handleCPP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP \&quot;before each\&quot; hook in \&quot;handleCPP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub(),\n  insertOne: sinon.stub(),\n  updateOne: sinon.stub(),\n};\ntestProblem = new Problem(adminDB, {});\nproblemId = \&quot;644bc03d00e76ef0f3d3137f\&quot;;\ncode = `int sum(int a, int b) {return a+b;}`;\nlanguage = \&quot;C++\&quot;;\nhandle = \&quot;testHandle\&quot;;\ntimestamp = \&quot;timastamp\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed9c3e73-c196-4b5c-94b3-62bbb1ec1d20&quot;,&quot;parentUUID&quot;:&quot;44c4125b-7d46-4960-9eaa-44d1b1e8c41b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accept for correct solution&quot;,&quot;fullTitle&quot;:&quot;Problems handleCPP should return accept for correct solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9002,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(0);\nsetTimeout(done, 9000);\nadminDB.findOne.onFirstCall().returns({\n  _id: new ObjectId(\&quot;644bc03d00e76ef0f3d3137f\&quot;),\n  author_handle: \&quot;nishant_89\&quot;,\n  title: \&quot;Add numbers in an array\&quot;,\n  content: \&quot;Add numbers in an array\&quot;,\n  correct_code_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    \&quot;int sum(int a,int b){\\n\&quot; +\n    \&quot;    return a+b;\\n\&quot; +\n    \&quot;}\\n\&quot; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;coutput.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;cin&gt;&gt;t;\\n\&quot; +\n    \&quot;while(t--){\\n\&quot; +\n    \&quot;\\t int a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;}\\n\&quot; +\n    \&quot;   \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  correct_code_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class CorrectCode {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;coutput.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(num1+num2+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\t// Close input and output files\\n\&quot; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\treader.close();\\n\&quot; +\n    \&quot;            writer.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  time_limit: 1,\n  input_format: \&quot;input\&quot;,\n  output_format: \&quot;output\&quot;,\n  example_input: \&quot;sample_input\&quot;,\n  example_output: \&quot;sample_output\&quot;,\n  function_def_CPP: \&quot;int sum(int a,int b){\\n}\&quot;,\n  input_template_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    &#x27;#include \&quot;funcDef.h\&quot;\\n&#x27; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;output.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\t\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;    cin&gt;&gt;t;\\n\&quot; +\n    \&quot;    while(t--){\\n\&quot; +\n    \&quot;\\tint a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;    }\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;    \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  function_def_JAVA:\n    \&quot;public class Solution {\\n\&quot; +\n    \&quot;    public static int add(int a, int b) {\\n\&quot; +\n    \&quot;        // Write your code here.\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  input_template_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class Func {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;output.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(Solution.add(num1,num2)+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\t// Close input and output files\\n\&quot; +\n    \&quot;            \\treader.close();\\n\&quot; +\n    \&quot;            \\twriter.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  testcases: \&quot;5\\n1 3\\n4 6\\n2 0\\n1 -1\\n2 3\&quot;,\n  timestamp: \&quot;2023-04-28T11:21:23.840Z\&quot;,\n  tags: [\&quot;a\&quot;, \&quot;b\&quot;],\n  level: \&quot;medium\&quot;,\n});\nadminDB.findOne.onSecondCall().returns({ problems: [] });\nadminDB.insertOne.returns({});\nadminDB.updateOne.returns({});\ntestProblem.handleCPP(problemId, handle, code, timestamp, language, res);\n// setTimeout(() =&gt; {\n//   expect(adminDB.findOne.callCount).to.equal(2);\n// }, 9000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3302c91f-a424-4419-8b2d-6667bcd426ba&quot;,&quot;parentUUID&quot;:&quot;44c4125b-7d46-4960-9eaa-44d1b1e8c41b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3302c91f-a424-4419-8b2d-6667bcd426ba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9002,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;731e6559-5282-42f1-ab3e-286e7c73b765&quot;,&quot;title&quot;:&quot;handleJAVA&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;handleJAVA\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems handleJAVA \&quot;before each\&quot; hook in \&quot;handleJAVA\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub(),\n  insertOne: sinon.stub(),\n  updateOne: sinon.stub(),\n};\ntestProblem = new Problem(adminDB, {});\nproblemId = \&quot;644bc03d00e76ef0f3d3137f\&quot;;\ncode = `public class Solution {public static int add(int a, int b) {return a+b;}}`;\nlanguage = \&quot;Java\&quot;;\nhandle = \&quot;testHandle\&quot;;\ntimestamp = \&quot;timastamp\&quot;;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8519f627-2696-4c41-866b-b0ca7b968693&quot;,&quot;parentUUID&quot;:&quot;731e6559-5282-42f1-ab3e-286e7c73b765&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accept for correct solution&quot;,&quot;fullTitle&quot;:&quot;Problems handleJAVA should return accept for correct solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10000,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(0);\nsetTimeout(done, 10000);\nadminDB.findOne.onFirstCall().returns({\n  _id: new ObjectId(\&quot;644bc03d00e76ef0f3d3137f\&quot;),\n  author_handle: \&quot;nishant_89\&quot;,\n  title: \&quot;Add numbers in an array\&quot;,\n  content: \&quot;Add numbers in an array\&quot;,\n  correct_code_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    \&quot;int sum(int a,int b){\\n\&quot; +\n    \&quot;    return a+b;\\n\&quot; +\n    \&quot;}\\n\&quot; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;coutput.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;cin&gt;&gt;t;\\n\&quot; +\n    \&quot;while(t--){\\n\&quot; +\n    \&quot;\\t int a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;}\\n\&quot; +\n    \&quot;   \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  correct_code_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class CorrectCode {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;coutput.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(num1+num2+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\t// Close input and output files\\n\&quot; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\treader.close();\\n\&quot; +\n    \&quot;            writer.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  time_limit: 1,\n  input_format: \&quot;input\&quot;,\n  output_format: \&quot;output\&quot;,\n  example_input: \&quot;sample_input\&quot;,\n  example_output: \&quot;sample_output\&quot;,\n  function_def_CPP: \&quot;int sum(int a,int b){\\n}\&quot;,\n  input_template_CPP:\n    \&quot;#include &lt;bits/stdc++.h&gt;\\n\&quot; +\n    \&quot;using namespace std;\\n\&quot; +\n    &#x27;#include \&quot;funcDef.h\&quot;\\n&#x27; +\n    \&quot;int main(){\\n\&quot; +\n    &#x27;    freopen(\&quot;input.txt\&quot;, \&quot;r\&quot;, stdin);                   \\n&#x27; +\n    &#x27;\\tfreopen(\&quot;output.txt\&quot;, \&quot;w\&quot;, stdout);\\n&#x27; +\n    \&quot;\\t\\n\&quot; +\n    \&quot;    int t;\\n\&quot; +\n    \&quot;    cin&gt;&gt;t;\\n\&quot; +\n    \&quot;    while(t--){\\n\&quot; +\n    \&quot;\\tint a,b;\\n\&quot; +\n    \&quot;    cin&gt;&gt;a&gt;&gt;b;\\n\&quot; +\n    &#x27;    cout&lt;&lt;sum(a,b)&lt;&lt;\&quot;\\\\n\&quot;;\\n&#x27; +\n    \&quot;    }\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;    \\n\&quot; +\n    \&quot;    return 0;\\n\&quot; +\n    \&quot;}\&quot;,\n  function_def_JAVA:\n    \&quot;public class Solution {\\n\&quot; +\n    \&quot;    public static int add(int a, int b) {\\n\&quot; +\n    \&quot;        // Write your code here.\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  input_template_JAVA:\n    \&quot;import java.io.*;\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;public class Func {\\n\&quot; +\n    \&quot;    public static void main(String[] args) {\\n\&quot; +\n    \&quot;        try {\\n\&quot; +\n    \&quot;            // Open input and output files\\n\&quot; +\n    &#x27;            BufferedReader reader = new BufferedReader(new FileReader(\&quot;input.txt\&quot;));\\n&#x27; +\n    &#x27;            BufferedWriter writer = new BufferedWriter(new FileWriter(\&quot;output.txt\&quot;));\\n&#x27; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\t// Read first number from input file\\n\&quot; +\n    \&quot;            String line = reader.readLine();\\n\&quot; +\n    \&quot;            int t = Integer.parseInt(line);\\n\&quot; +\n    \&quot;\\n\&quot; +\n    \&quot;\\t\\twhile(t&gt;0){\\n\&quot; +\n    \&quot;\\t\\t\\tString input = reader.readLine();\\n\&quot; +\n    &#x27;\\t\\t\\tString[] inputArray = input.split(\&quot; \&quot;); // splits the input by space\\n&#x27; +\n    \&quot;        \\t\\tint num1 = Integer.parseInt(inputArray[0]); // converts the first number to an integer\\n\&quot; +\n    \&quot;        \\t\\tint num2 = Integer.parseInt(inputArray[1]); \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    &#x27;            \\twriter.write(Solution.add(num1,num2)+\&quot;\\\\n\&quot;);\\n&#x27; +\n    \&quot;\\t\\t\\tt--;\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;\\t\\t}\\n\&quot; +\n    \&quot;\\t\\t// Close input and output files\\n\&quot; +\n    \&quot;            \\treader.close();\\n\&quot; +\n    \&quot;            \\twriter.close();\\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;            \\n\&quot; +\n    \&quot;        } catch (IOException e) {\\n\&quot; +\n    \&quot;            e.printStackTrace();\\n\&quot; +\n    \&quot;        }\\n\&quot; +\n    \&quot;    }\\n\&quot; +\n    \&quot;}\&quot;,\n  testcases: \&quot;5\\n1 3\\n4 6\\n2 0\\n1 -1\\n2 3\&quot;,\n  timestamp: \&quot;2023-04-28T11:21:23.840Z\&quot;,\n  tags: [\&quot;a\&quot;, \&quot;b\&quot;],\n  level: \&quot;medium\&quot;,\n});\nadminDB.findOne.onSecondCall().returns({ problems: [] });\nadminDB.insertOne.returns({});\nadminDB.updateOne.returns({});\ntestProblem.handleJAVA(problemId, handle, code, timestamp, language, res);\n// setTimeout(() =&gt; {\n//   expect(adminDB.findOne.callCount).to.equal(2);\n// }, 9000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a19dea3d-1301-470d-8668-dab55c65bf51&quot;,&quot;parentUUID&quot;:&quot;731e6559-5282-42f1-ab3e-286e7c73b765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a19dea3d-1301-470d-8668-dab55c65bf51&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10000,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;title&quot;:&quot;postProblem&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;postProblem\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem \&quot;before each\&quot; hook in \&quot;postProblem\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create stubs for adminJWT and adminDB\nadminJWT = {\n  verifyToken: sinon.stub().returns({ handle: &#x27;admin&#x27;, type: &#x27;2&#x27; }),\n};\nadminDB = {\n  insertOne: sinon.stub().returns(true),\n  problem: &#x27;problemCollection&#x27;,\n};\n  \n// Create a fake response object with a send function\nres = {\n  send: sinon.stub(),\n};\npostProblem = new Problem(adminDB,adminJWT).postProblem;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2b009ed0-dc96-4a87-aeee-8ed478a8760c&quot;,&quot;parentUUID&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should post a problem successfully&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should post a problem successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n  \n  \n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n  \n// Verify the expected behavior\n  \n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n  \n// Verify that adminDB.insertOne is called with the correct arguments\nexpect(adminDB.insertOne.calledOnce).to.be.true;\nexpect(adminDB.insertOne.calledWith(adminDB.problem, sinon.match.any)).to.be.true;\n  \n// Verify that res.send is called with the correct success message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({ success: true, message: &#x27;Problem posted successfully.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59f3cf14-773d-4238-8f36-2004628fdcdc&quot;,&quot;parentUUID&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message if the user is not authorized&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should return an error message if the user is not authorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n  \n// Modify the stub for adminJWT to return a different user type\nadminJWT.verifyToken.returns({ handle: &#x27;user&#x27;, type: &#x27;1&#x27; });\n  \n// Import the function to be tested here and pass the stubs and mocks\n  \n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n  \n// Verify the expected behavior\n  \n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n  \n// Verify that adminDB.insertOne is not called\nexpect(adminDB.insertOne.notCalled).to.be.true;\n  \n// Verify that res.send is called with the correct error message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({\n  success: false,\n  message: &#x27;You are not authorized to post problems.&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b62aefb-3d17-47a2-a947-637b9c22f7f2&quot;,&quot;parentUUID&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle token expiration error&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should handle token expiration error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;expiredToken&#x27;,\n    // other properties required by the function\n  },\n};\n    // Modify the stub for adminJWT to throw a TokenExpiredError\n    adminJWT.verifyToken.throws(new TokenExpiredError(&#x27;Token expired&#x27;));\n\n    // Import the function to be tested here and pass the stubs and mocks\n\n    // Call the function\n    await postProblem(req, res, adminJWT, adminDB);\n\n    // Verify the expected behavior\n\n    // Verify that adminJWT.verifyToken is called with the correct arguments\n    expect(adminJWT.verifyToken.calledOnce).to.be.true;\n    expect(adminJWT.verifyToken.calledWith(&#x27;expiredToken&#x27;)).to.be.true;\n\n    // Verify that adminDB.insertOne is not called\n    expect(adminDB.insertOne.notCalled).to.be.true;\n\n    // Verify that res.send is called with the correct error message\n    expect(res.send.calledOnce).to.be.true;\n    expect(res.send.calledWith({ success: false, message: &#x27;Token has expired.&#x27; })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b6a0725c-1b85-40ad-bbbe-bb2fde49d309&quot;,&quot;parentUUID&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle internal server error during problem posting&quot;,&quot;fullTitle&quot;:&quot;Problems postProblem should handle internal server error during problem posting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the request object with necessary properties\nconst req = {\n  body: {\n    userToken: &#x27;fakeToken&#x27;,\n    // other properties required by the function\n  },\n};\n// Modify the stub for adminDB to return false, indicating an internal server error\nadminDB.insertOne.returns(false);\n// Import the function to be tested here and pass the stubs and mocks\n// Call the function\nawait postProblem(req, res, adminJWT, adminDB);\n// Verify the expected behavior\n// Verify that adminJWT.verifyToken is called with the correct arguments\nexpect(adminJWT.verifyToken.calledOnce).to.be.true;\nexpect(adminJWT.verifyToken.calledWith(&#x27;fakeToken&#x27;)).to.be.true;\n// Verify that adminDB.insertOne is called with the correct arguments\nexpect(adminDB.insertOne.calledOnce).to.be.true;\nexpect(adminDB.insertOne.calledWith(adminDB.problem, sinon.match.any)).to.be.true;\n// Verify that res.send is called with the correct error message\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.calledWith({\n  success: false,\n  message: &#x27;Problem can\\&#x27;t be posted due to internal reasons&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a636f3a-48fc-40e2-b5a4-dfa473eaabcd&quot;,&quot;parentUUID&quot;:&quot;9f79e58d-e549-4bde-885c-5a7305d60900&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;59f3cf14-773d-4238-8f36-2004628fdcdc&quot;,&quot;7b62aefb-3d17-47a2-a947-637b9c22f7f2&quot;,&quot;b6a0725c-1b85-40ad-bbbe-bb2fde49d309&quot;,&quot;8a636f3a-48fc-40e2-b5a4-dfa473eaabcd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;title&quot;:&quot;fetchSolvedProblems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchSolvedProblems\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems \&quot;before each\&quot; hook in \&quot;fetchSolvedProblems\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT = {\n  verifyToken: sinon.stub().returns({ handle })\n};\n\nreq = { body: { userToken } };\nres = {\n  send: sinon.stub(),\n};\nadminDB = {\n  findOne: sinon.stub().returns({ problems: solvedProblems }),\n  solved: &#x27;solved_collection&#x27;\n};\nfetchSolvedProblems = new Problem(adminDB,adminJWT).fetchSolvedProblems;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1717ad0e-e030-477f-b8be-dbeeb5f77533&quot;,&quot;parentUUID&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch solved problems of user from solved collection&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should fetch solved problems of user from solved collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await fetchSolvedProblems(req, res);\n    expect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\n    expect(adminDB.findOne.calledOnceWith(adminDB.solved, { handle }, { problems: 1, _id: 0 })).to.be.true;\n    expect(res.send.calledOnceWith({\n      success: true,\n      problems: solvedProblems,\n      message: &#x27;Solved problems fetched successfully&#x27;\n    })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a547960f-0cb8-48bb-9de3-db75b7ce826a&quot;,&quot;parentUUID&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for token expired error&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for token expired error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken= sinon.stub().throws(new TokenExpiredError());\nawait fetchSolvedProblems(req, res);\nexpect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Token has expired.&#x27;\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f80eaccc-5560-47db-8bda-9112fa8e860b&quot;,&quot;parentUUID&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for other token errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for other token errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken= sinon.stub().throws(new JsonWebTokenError());\nawait fetchSolvedProblems(req, res);\nexpect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User has logged out.Kindly login again&#x27;\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ac8f69e-e900-49d3-be68-bc50f58abce7&quot;,&quot;parentUUID&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error message for other errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchSolvedProblems should send error message for other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne = sinon.stub().throws(new Error(&#x27;Some error occurred&#x27;));    \n  await fetchSolvedProblems(req, res);\n  expect(adminJWT.verifyToken.calledOnceWith(userToken)).to.be.true;\n  expect(adminDB.findOne.calledOnceWith(adminDB.solved, { handle: &#x27;testUser&#x27; }, { problems: 1, _id: 0 })).to.be.true;\n  expect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Some error occurred&#x27;\n  })).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9f0e2683-3076-4890-9f82-8bc39e5e70c7&quot;,&quot;parentUUID&quot;:&quot;f16e5023-ced4-4460-87fe-2a51515366c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a547960f-0cb8-48bb-9de3-db75b7ce826a&quot;,&quot;f80eaccc-5560-47db-8bda-9112fa8e860b&quot;,&quot;6ac8f69e-e900-49d3-be68-bc50f58abce7&quot;,&quot;9f0e2683-3076-4890-9f82-8bc39e5e70c7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;title&quot;:&quot;fetchAllSubmissions&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions \&quot;before each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;res = {\n  send: sinon.stub(),\n};\nadminDB = {\n  find: sinon.stub(),\n  problem: \&quot;problemCollection\&quot;,\n  solution: \&quot;solutionCollection\&quot;,\n}\nadminJWT = {\n  verifyToken: sinon.stub(),\n};\n       fetchAllSubmissions = new Problem(adminDB,adminJWT).fetchAllSubmissions;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b66ca6c3-e94e-46e0-b13e-9694579222de&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions \&quot;after each\&quot; hook in \&quot;fetchAllSubmissions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5eb379e-b44f-412e-97f4-6e569c008a11&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return submissions for a valid token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return submissions for a valid token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminJWT.verifyToken.returns({\n    handle: handle,\n  });\n  const data = [\n    {\n      _id: new ObjectId(),\n      problemId: new ObjectId(),\n      handle: \&quot;testHandle\&quot;,\n      code: \&quot;testCode\&quot;,\n      timestamp: \&quot;testTimestamp\&quot;,\n      language: \&quot;testLanguage\&quot;,\n    },\n  ];\n  adminDB.find.withArgs(adminDB.solution, { handle: handle }).returns(data);\n  const problemData = [\n    {\n      _id: data[0].problemId,\n      title: \&quot;testTitle\&quot;,\n    },\n  ];\n  adminDB.find.withArgs(adminDB.problem, { _id: { $in: [data[0].problemId] } }, {}, { title: 1 })\n    .returns(problemData);\n    \n  await fetchAllSubmissions(req, res);\n    \n  expect(res.send.calledOnce).to.be.true;\n  expect(res.send.firstCall.args[0]).to.deep.equal({\n    success: true,\n    submissions: [\n      {\n        ...data[0],\n        title: problemData[0].title,\n      },\n    ],\n    message: \&quot;Submissions fetched successfully\&quot;,\n  });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ce908106-1b3f-4c35-a719-474c10d87e63&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for an invalid token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for an invalid token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new JsonWebTokenError(\&quot;invalid token\&quot;);\nadminJWT.verifyToken = sinon.stub().throws(error);\n    \nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;User has logged out.Kindly login again\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e77f294-0585-45ba-a1a8-5ff3bc166e94&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for an expired token&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for an expired token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new TokenExpiredError(\&quot;expired token\&quot;);\nadminJWT.verifyToken = sinon.stub().throws(error);\n    \nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Token has expired.\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9376a650-74ae-4acc-b20e-989a35ffe7e8&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message for any other errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllSubmissions should return an error message for any other errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const error = new Error(\&quot;unknown error\&quot;);\nadminDB.find = sinon.stub().throws(error);\nadminJWT.verifyToken.returns({\n  handle: handle,\n});\nawait fetchAllSubmissions(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: error.message,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a0b5eed9-5f08-4c8f-aebf-144e78e1b621&quot;,&quot;parentUUID&quot;:&quot;c01bcd79-fd53-4900-a49f-432a25633d43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ce908106-1b3f-4c35-a719-474c10d87e63&quot;,&quot;4e77f294-0585-45ba-a1a8-5ff3bc166e94&quot;,&quot;9376a650-74ae-4acc-b20e-989a35ffe7e8&quot;,&quot;a0b5eed9-5f08-4c8f-aebf-144e78e1b621&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4416a2c2-b3c6-47d6-99f9-8c33696bfd75&quot;,&quot;title&quot;:&quot;fetchProblemDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchProblemDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails \&quot;before each\&quot; hook in \&quot;fetchProblemDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: sinon.stub(),\n  problem: \&quot;problemCollection\&quot;,\n};\n    \nreq = {\n  body: {\n    problemId: \&quot;someProblemI\&quot;,\n  },\n};\n    \nres = {\n  send: sinon.stub(),\n};\nfetchProblemDetails = new Problem(adminDB,{}).fetchProblemDetails;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c140697-6928-4c7e-bd77-577d3305a169&quot;,&quot;parentUUID&quot;:&quot;4416a2c2-b3c6-47d6-99f9-8c33696bfd75&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return problem details when valid problemId is provided&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails should return problem details when valid problemId is provided&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedData = { problem: \&quot;data\&quot; };\nadminDB.findOne.resolves(expectedData);\n    \nawait fetchProblemDetails(req, res, adminDB);\n    \nsinon.assert.calledWith(\n  adminDB.findOne,\n  \&quot;problemCollection\&quot;,\n  { _id: new ObjectId(\&quot;someProblemI\&quot;) },\n  { _id: 0, correct_code_CPP: 0, correct_code_JAVA: 0, testcases: 0 }\n);\n    \nsinon.assert.calledWith(res.send, {\n  success: true,\n  problem: expectedData,\n  message: \&quot;Problem details fetched successfully\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a9384c2-f19c-4f61-a050-99ab447a88f4&quot;,&quot;parentUUID&quot;:&quot;4416a2c2-b3c6-47d6-99f9-8c33696bfd75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return an error message when an error occurs while fetching the problem details&quot;,&quot;fullTitle&quot;:&quot;Problems fetchProblemDetails should return an error message when an error occurs while fetching the problem details&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const expectedError = new Error(\&quot;Some error occurred\&quot;);\nadminDB.findOne.rejects(expectedError);\n    \nawait fetchProblemDetails(req, res, adminDB);\n    \nsinon.assert.calledWith(res.send, {\n  success: false,\n  message: expectedError.message,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73a73d3c-7522-4426-88fd-4db571d32e93&quot;,&quot;parentUUID&quot;:&quot;4416a2c2-b3c6-47d6-99f9-8c33696bfd75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1a9384c2-f19c-4f61-a050-99ab447a88f4&quot;,&quot;73a73d3c-7522-4426-88fd-4db571d32e93&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7f83623a-4db4-4829-8336-2356c01d93f7&quot;,&quot;title&quot;:&quot;fetchAllProblems&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/problem.test.js&quot;,&quot;file&quot;:&quot;/test/problem.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fetchAllProblems\&quot;&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems \&quot;before each\&quot; hook in \&quot;fetchAllProblems\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  find: sinon.stub(),\n};\nreq = {};\nres = {\n  send: sinon.spy(),\n};\nfetchAllProblems = new Problem(adminDB,{}).fetchAllProblems;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d34c0902-63e5-4adf-910a-922d3b500736&quot;,&quot;parentUUID&quot;:&quot;7f83623a-4db4-4829-8336-2356c01d93f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all problems from the problem collection&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems should fetch all problems from the problem collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const data = [{ title: &#x27;Problem 1&#x27;, timestamp: 1234567890 }];\nadminDB.find.returns(data)\n    \nawait fetchAllProblems(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  problems: data,\n  message: &#x27;Problems fetched successfully&#x27;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c2f276a3-b0ec-4f8d-98e7-33f44d013f59&quot;,&quot;parentUUID&quot;:&quot;7f83623a-4db4-4829-8336-2356c01d93f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors&quot;,&quot;fullTitle&quot;:&quot;Problems fetchAllProblems should handle errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = &#x27;Error fetching problems&#x27;;\nadminDB.find = sinon.stub().throws(new Error(errorMessage));\n    \nawait fetchAllProblems(req, res);\n    \nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: errorMessage,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05e52761-4564-4848-8b41-9199bff5b345&quot;,&quot;parentUUID&quot;:&quot;7f83623a-4db4-4829-8336-2356c01d93f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c2f276a3-b0ec-4f8d-98e7-33f44d013f59&quot;,&quot;05e52761-4564-4848-8b41-9199bff5b345&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f252c517-b392-4c2b-bebe-0633e5489032&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;title&quot;:&quot;userLogin&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;before each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  createToken: stub(),\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;796afca3-018e-4afd-b608-b4bbd181b837&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogin \&quot;after each\&quot; hook in \&quot;userLogin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;900dea94-827f-4309-b915-7e821ac35463&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if login is successful&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send success response if login is successful&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:131,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(req.body.password, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nadminJWT.createToken.returns(\&quot;mockToken\&quot;);\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.true;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: true,\n  message: \&quot;Login Successful\&quot;,\n  type: type,\n  userToken: \&quot;mockToken\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d52786e-3f21-4432-a1a6-8a4b9dd23d8d&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if password does not match&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if password does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = bcrypt.hashSync(\&quot;\&quot;, 10);\nadminDB.findOne.resolves({\n  email: req.body.email,\n  password: hashedPassword,\n  type: type,\n  handle: handle,\n});\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.calledOnce).to.be.true;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ef1545f3-8748-43fe-940e-371789538f85&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves(null);\nawait user.userLogin(req, res);\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Invalid Email or Password\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a5a3617-e81b-4231-9c72-faaed9bf733f&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User userLogin should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.rejects(new Error(\&quot;Database error\&quot;));\nstub(bcrypt, \&quot;compare\&quot;).callsFake((_password, hash, callback) =&gt; {\n  callback(null, bcrypt.compareSync(_password, hash));\n});\nawait user.userLogin(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: email },\n    {\n      password: 1,\n      type: 1,\n      handle: 1,\n    }\n  )\n).to.be.true;\nexpect(bcrypt.compare.called).to.be.false;\nexpect(adminJWT.createToken.calledOnceWithExactly(email, handle, type)).to\n  .be.false;\nexpect(res.send.calledOnce).to.be.true;\nexpect(res.send.firstCall.args[0]).to.deep.equal({\n  success: false,\n  message: \&quot;Database error\&quot;,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;08920949-97d7-433b-b7b8-a5dc3b5d933a&quot;,&quot;parentUUID&quot;:&quot;f620dfc9-761b-4ace-acac-89b59c778417&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8d52786e-3f21-4432-a1a6-8a4b9dd23d8d&quot;,&quot;ef1545f3-8748-43fe-940e-371789538f85&quot;,&quot;6a5a3617-e81b-4231-9c72-faaed9bf733f&quot;,&quot;08920949-97d7-433b-b7b8-a5dc3b5d933a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:261,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;title&quot;:&quot;getUserDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;before each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  users: \&quot;users\&quot;,\n  findOne: stub(),\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: \&quot;mockToken\&quot;,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;591173f9-8905-4cd7-9311-f07b5ca08483&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails \&quot;after each\&quot; hook in \&quot;getUserDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc766d50-c11a-4cdf-af27-009b22a9559d&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send user details if token is valid and user exists&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send user details if token is valid and user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    { password: 0, _id: 0 }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Details\&quot;,\n    user: { email: decodedToken.email },\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7990f04d-32e1-4e45-b9c5-5623f950db05&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new jwt.TokenExpiredError(\&quot;Token has expired\&quot;);\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10df71b8-8e12-4890-affb-eea27b576566&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is invalid&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if token is invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const jsonWebTokenError = new jwt.JsonWebTokenError(\&quot;Invalid token\&quot;);\nadminJWT.verifyToken.throws(jsonWebTokenError);\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User has logged out.Kindly login again\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1b66180-0806-4cfd-afc3-cfae5174f933&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs&quot;,&quot;fullTitle&quot;:&quot;User getUserDetails should send error response if an error occurs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.getUserDetails(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: errorMessage,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b8b4771-393b-4612-96c4-e2b299ec460c&quot;,&quot;parentUUID&quot;:&quot;40e91700-ec27-4e33-ad8a-a54c57fe13ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7990f04d-32e1-4e45-b9c5-5623f950db05&quot;,&quot;10df71b8-8e12-4890-affb-eea27b576566&quot;,&quot;b1b66180-0806-4cfd-afc3-cfae5174f933&quot;,&quot;6b8b4771-393b-4612-96c4-e2b299ec460c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;title&quot;:&quot;updateProfile&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;before each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nadminJWT = {\n  verifyToken: stub(),\n};\nreq = {\n  body: {\n    userToken: userToken,\n    city: city,\n    birthdate: birthdate,\n    address: address,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, adminJWT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25c54b96-fdfd-43a8-9f75-dd4812b1cebc&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;fullTitle&quot;:&quot;User updateProfile \&quot;after each\&quot; hook in \&quot;updateProfile\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;765390a4-925e-4acf-86cc-6af2f8983367&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update profile if user exists and token is valid&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should update profile if user exists and token is valid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: email,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves({ email: decodedToken.email });\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWithExactly(\n    adminDB.users,\n    { email: decodedToken.email },\n    {\n      $set: {\n        city: req.body.city,\n        birthdate: req.body.birthdate,\n        address: req.body.address,\n      },\n    }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;Profile Updated Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67ef03c6-b6d6-4c0b-9cef-2cc1114156e8&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if token is expired&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if token is expired&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tokenExpiredError = new TokenExpiredError(\&quot;Token has expired\&quot;);\ntokenExpiredError.name = \&quot;TokenExpiredError\&quot;;\nadminJWT.verifyToken.throws(tokenExpiredError);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Token has expired.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;020cca74-3e51-4999-b8f7-010de18e5afc&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if an error occurs during update&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if an error occurs during update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Database error\&quot;;\nadminJWT.verifyToken.throws(new Error(errorMessage));\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Profile Updation Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ebd45fe-8232-4c61-a802-417e30d9d00a&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User updateProfile should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const decodedToken = {\n  email: \&quot;test@example.com\&quot;,\n};\nadminJWT.verifyToken.returns(decodedToken);\nadminDB.findOne.resolves(null);\nawait user.updateProfile(req, res);\nexpect(adminJWT.verifyToken.calledOnceWithExactly(req.body.userToken)).to\n  .be.true;\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: decodedToken.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User does not exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c856daa3-36db-44fc-a552-308a3aa770dc&quot;,&quot;parentUUID&quot;:&quot;0cd037de-a6d5-471d-8644-35045f04a2fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;67ef03c6-b6d6-4c0b-9cef-2cc1114156e8&quot;,&quot;020cca74-3e51-4999-b8f7-010de18e5afc&quot;,&quot;5ebd45fe-8232-4c61-a802-417e30d9d00a&quot;,&quot;c856daa3-36db-44fc-a552-308a3aa770dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;title&quot;:&quot;fillDetails&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;before each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    password: password,\n    name: \&quot;user\&quot;,\n    handle: handle,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88bf204a-c16c-4959-bf88-a17e3eed1129&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;fullTitle&quot;:&quot;User fillDetails \&quot;after each\&quot; hook in \&quot;fillDetails\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3fa7e5e4-728b-4026-a53c-0e502560f0d1&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const existingUser = {\n  email: req.body.email,\n};\nadminDB.findOne.resolves(existingUser);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;028b5788-f869-4615-ac1f-f8dd7d029e09&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if any required detail is missing&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if any required detail is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req.body.email = \&quot;\&quot;;\nreq.body.password = \&quot;\&quot;;\nreq.body.name = \&quot;\&quot;;\nreq.body.handle = \&quot;\&quot;;\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Please fill all the details.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54d69106-e747-403e-9190-14c391448ef1&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt hash fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if bcrypt hash fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const errorMessage = \&quot;Bcrypt hash failed\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).yields(new Error(errorMessage));\nawait user.fillDetails(req, res);\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;11e76ce1-7a21-4a5b-9d11-dd50d2b7c1ec&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should register the user if all details are provided and user does not exist&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should register the user if all details are provided and user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nconst newUser = {\n  email: req.body.email,\n  password: hashedPassword,\n  name: req.body.name,\n  handle: req.body.handle,\n  type: \&quot;0\&quot;,\n  city: null,\n  birthdate: null,\n  address: null,\n};\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(adminDB.insertOne.calledWithExactly(adminDB.users, newUser)).to.be\n  .true;\nexpect(\n  adminDB.insertOne.calledWithExactly(adminDB.solved, {\n    handle: req.body.handle,\n    problems: [],\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;User Registered Successfully\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b533958f-0929-466d-b3e3-385ff0780982&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user registration fails&quot;,&quot;fullTitle&quot;:&quot;User fillDetails should send error response if user registration fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const hashedPassword = \&quot;hashedPassword\&quot;;\nstub(bcrypt, \&quot;hash\&quot;).callsFake((_password, _len, callback) =&gt; {\n  callback(null, hashedPassword);\n});\nadminDB.findOne.resolves(null);\nadminDB.insertOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.fillDetails(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(bcrypt.hash.called).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWithExactly(adminDB.users, {\n    email: req.body.email,\n    password: hashedPassword,\n    name: req.body.name,\n    handle: req.body.handle,\n    type: \&quot;0\&quot;,\n    city: null,\n    birthdate: null,\n    address: null,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;User Registration Failed\&quot;,\n  })\n).to.be.true;\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d04ae432-f82d-4f97-8e42-cfb909046fab&quot;,&quot;parentUUID&quot;:&quot;bb78b078-0cfc-4b51-8b59-834aaf713a8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;028b5788-f869-4615-ac1f-f8dd7d029e09&quot;,&quot;54d69106-e747-403e-9190-14c391448ef1&quot;,&quot;11e76ce1-7a21-4a5b-9d11-dd50d2b7c1ec&quot;,&quot;b533958f-0929-466d-b3e3-385ff0780982&quot;,&quot;d04ae432-f82d-4f97-8e42-cfb909046fab&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;322093ea-a966-405d-83aa-dd2bb3387e34&quot;,&quot;title&quot;:&quot;verifyOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP \&quot;before each\&quot; hook in \&quot;verifyOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB = {\n  findOne: stub(),\n  deleteOne: stub(),\n  otp: \&quot;otp\&quot;,\n};\nreq = {\n  body: {\n    email: email,\n    otp: otp,\n  },\n};\nres = {\n  send: stub(),\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ac3d43a-f817-4b47-b50c-a4d1986cf615&quot;,&quot;parentUUID&quot;:&quot;322093ea-a966-405d-83aa-dd2bb3387e34&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if OTP matches&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send success response if OTP matches&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: req.body.otp,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.deleteOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: true,\n    message: \&quot;OTP Verified Successfully\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4634f415-7383-4023-b53a-2a46d93abbb8&quot;,&quot;parentUUID&quot;:&quot;322093ea-a966-405d-83aa-dd2bb3387e34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP does not match&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP does not match&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.resolves({\n  email: req.body.email,\n  otp: \&quot;wrongOTP\&quot;,\n});\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;Invalid OTP\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ee415e58-87c8-43cb-8bb0-86d3e7af8c5a&quot;,&quot;parentUUID&quot;:&quot;322093ea-a966-405d-83aa-dd2bb3387e34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if OTP verification fails&quot;,&quot;fullTitle&quot;:&quot;User verifyOTP should send error response if OTP verification fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nawait user.verifyOTP(req, res);\nexpect(\n  adminDB.findOne.calledOnceWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWithExactly({\n    success: false,\n    message: \&quot;OTP Verification Failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10e89b4e-3bff-4ece-9434-380fbd9f5c3d&quot;,&quot;parentUUID&quot;:&quot;322093ea-a966-405d-83aa-dd2bb3387e34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4634f415-7383-4023-b53a-2a46d93abbb8&quot;,&quot;ee415e58-87c8-43cb-8bb0-86d3e7af8c5a&quot;,&quot;10e89b4e-3bff-4ece-9434-380fbd9f5c3d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;title&quot;:&quot;sendOTP&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;fullTitle&quot;:&quot;User sendOTP \&quot;before each\&quot; hook in \&quot;sendOTP\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { email: email } };\nres = {\n  send: stub(),\n};\n// Mocking adminDB and adminMail objects\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  insertOne: stub(),\n  users: \&quot;users\&quot;,\n  otp: \&quot;otp\&quot;,\n};\nadminMail = {\n  sendOTP: stub(),\n};\n// Importing the sendOTP function\nuser = new User(adminDB, {}, adminMail);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f35c9146-da50-4b03-887c-99b824f117a2&quot;,&quot;parentUUID&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send OTP and respond with success message if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(adminDB.findOne.callCount).to.equal(2);\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.otp, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(\n  adminDB.insertOne.calledOnceWith(adminDB.otp, {\n    email: req.body.email,\n    otp: 500000,\n  })\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad760db6-dda7-4e3e-942a-682f899cdd22&quot;,&quot;parentUUID&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send OTP and respond with success message if otp exists in the otp collection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.onCall(0).returns(null);\nadminDB.findOne.onCall(1).returns(true);\nconst mathRandomStub = stub(Math, \&quot;random\&quot;).returns(0.5);\nconst mathFloorStub = stub(Math, \&quot;floor\&quot;).returns(500000);\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledWithExactly(adminDB.users, {\n    email: req.body.email,\n  })\n).to.be.true;\nexpect(mathRandomStub.calledOnce).to.be.true;\nexpect(mathFloorStub.calledOnce).to.be.true;\nexpect(adminMail.sendOTP.calledOnceWith(req.body.email, 500000)).to.be\n  .true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.otp,\n    { email: email },\n    { $set: { otp: 500000 } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;OTP Sent Successfully\&quot;,\n  })\n).to.be.true;\nmathRandomStub.restore();\nmathFloorStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6e96ae5-36ca-4db7-b638-bb9e2e88b705&quot;,&quot;parentUUID&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user already exists&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should send error response if user already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to return a user (user already exists)\nadminDB.findOne.returns({ email: email });\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User already exists\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db34e610-8153-4a73-9ac6-e0c6c709c4b3&quot;,&quot;parentUUID&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User sendOTP should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.findOne to throw an error\nadminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\n// Calling the sendOTP function\nawait user.sendOTP(req, res);\n// Assertions\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminMail.sendOTP.notCalled).to.be.true;\nexpect(adminDB.insertOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;OTP generation failed.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc954884-023d-4eda-8e24-952a92cc6af4&quot;,&quot;parentUUID&quot;:&quot;7f9107e0-1f80-488f-a8c1-c2843dca120c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ad760db6-dda7-4e3e-942a-682f899cdd22&quot;,&quot;c6e96ae5-36ca-4db7-b638-bb9e2e88b705&quot;,&quot;db34e610-8153-4a73-9ac6-e0c6c709c4b3&quot;,&quot;dc954884-023d-4eda-8e24-952a92cc6af4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;title&quot;:&quot;changePassword&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;fullTitle&quot;:&quot;User changePassword \&quot;before each\&quot; hook in \&quot;changePassword\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;req = { body: { email: email, newPassword: newpassword } };\nres = {\n  send: stub(),\n};\nadminDB = {\n  findOne: stub(),\n  updateOne: stub(),\n  users: \&quot;users\&quot;,\n};\nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae7caa84-0251-42dd-a799-680569a0eace&quot;,&quot;parentUUID&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change password and respond with success message if user exists&quot;,&quot;fullTitle&quot;:&quot;User changePassword should change password and respond with success message if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, null, hash);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(\n  adminDB.updateOne.calledOnceWith(\n    adminDB.users,\n    { email: req.body.email },\n    { $set: { password: hash } }\n  )\n).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: true,\n    message: \&quot;Password Changed Successfully.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d11c4e7-84e6-45fa-91ea-efdae9373893&quot;,&quot;parentUUID&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if bcrypt.hash encounters an error&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if bcrypt.hash encounters an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns({ email: email });\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.calledOnceWith(req.body.newPassword, 10)).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2fc3476b-d041-4324-9fa1-606793f9595c&quot;,&quot;parentUUID&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User changePassword should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.returns(null);\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;User does not exists.\&quot;,\n  })\n).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98df7740-0363-4b50-a165-60c6ff3a646d&quot;,&quot;parentUUID&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and respond with failure message&quot;,&quot;fullTitle&quot;:&quot;User changePassword should handle errors and respond with failure message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;adminDB.findOne.throws(new Error(\&quot;Database error\&quot;));\nconst bcryptHashStub = stub(bcrypt, \&quot;hash\&quot;)\n  .callsArgWith(2, new Error(\&quot;Hashing error\&quot;));\nawait user.changePassword(req, res);\nexpect(\n  adminDB.findOne.calledOnceWith(adminDB.users, { email: req.body.email })\n).to.be.true;\nexpect(bcrypt.hash.notCalled).to.be.true;\nexpect(adminDB.updateOne.notCalled).to.be.true;\nexpect(\n  res.send.calledOnceWith({\n    success: false,\n    message: \&quot;Password Updation Failed due to some internal error.\&quot;,\n  })\n).to.be.true;\nbcryptHashStub.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db4ace13-6932-4569-b016-1909ebcfad0b&quot;,&quot;parentUUID&quot;:&quot;f0a0bf35-efc3-480b-977f-d019ddfde91d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6d11c4e7-84e6-45fa-91ea-efdae9373893&quot;,&quot;2fc3476b-d041-4324-9fa1-606793f9595c&quot;,&quot;98df7740-0363-4b50-a165-60c6ff3a646d&quot;,&quot;db4ace13-6932-4569-b016-1909ebcfad0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;title&quot;:&quot;userLogout&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;before each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = { body: { userToken: &#x27;validToken&#x27; } };\nres = {\n  send: stub(),\n};\n  \n// Mocking adminJWT and adminDB objects\nadminJWT = {\n  verifyToken: stub(),\n};\n  \nadminDB = {\n  findOne: stub(),\n  users: &#x27;users&#x27;,\n};\n\n// Importing the userLogout function\nuser = new User(adminDB, adminJWT, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ce42e236-311c-4df6-9934-0c6f26a683a9&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;fullTitle&quot;:&quot;User userLogout \&quot;after each\&quot; hook in \&quot;userLogout\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b39f708-ed01-42cb-91c2-bc8d4243acd0&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send success response if user exists&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send success response if user exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return user data\nadminDB.findOne.returns({ email: email });\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;User Logged Out Successfully&#x27;,\n  userToken: &#x27;&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c25d32d-2de2-4d8f-a0c4-409c3edeffeb&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send error response if user does not exist&quot;,&quot;fullTitle&quot;:&quot;User userLogout should send error response if user does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to return email\nadminJWT.verifyToken.returns({ email: email });\n  \n// Stubbing adminDB.findOne to return null (user does not exist)\nadminDB.findOne.returns(null);\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(adminDB.findOne.calledOnceWith(adminDB.users, { email: email })).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User does not exists&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bbe8f858-21c8-40e3-977f-6610c884951d&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle TokenExpiredError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle TokenExpiredError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw TokenExpiredError\nadminJWT.verifyToken.throws(new TokenExpiredError(&#x27;Token expired&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;User has been logged out.&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71caa475-46a5-4f6e-b286-9ffde987653b&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle JsonWebTokenError and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle JsonWebTokenError and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw JsonWebTokenError\nadminJWT.verifyToken.throws(new JsonWebTokenError(&#x27;Invalid token&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: \&quot;User has logged out.Kindly login again\&quot;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a76f9e06-2ae9-4eb5-8c4a-f7ac069d0442&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle other errors and send appropriate response&quot;,&quot;fullTitle&quot;:&quot;User userLogout should handle other errors and send appropriate response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminJWT.verifyToken to throw an error\nadminJWT.verifyToken.throws(new Error(&#x27;Some error&#x27;));\n  \n// Calling the userLogout function\nawait user.userLogout(req, res);\n  \n// Assertions\nexpect(adminJWT.verifyToken.calledOnceWith(req.body.userToken)).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Some error&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;684a963c-fee6-4d35-99f9-c8c6e1aecdfe&quot;,&quot;parentUUID&quot;:&quot;604c7935-a7d0-4afd-a4bb-f176ae12c351&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9c25d32d-2de2-4d8f-a0c4-409c3edeffeb&quot;,&quot;bbe8f858-21c8-40e3-977f-6610c884951d&quot;,&quot;71caa475-46a5-4f6e-b286-9ffde987653b&quot;,&quot;a76f9e06-2ae9-4eb5-8c4a-f7ac069d0442&quot;,&quot;684a963c-fee6-4d35-99f9-c8c6e1aecdfe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;226c518f-39b2-4fff-808d-0543b7880fbb&quot;,&quot;title&quot;:&quot;getAllHandles&quot;,&quot;fullFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/test/user.test.js&quot;,&quot;file&quot;:&quot;/test/user.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;before each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mocking req and res objects\nreq = {};\nres = {\n  send: stub(),\n};\n  \n// Mocking adminDB object\nadminDB = {\n  find: stub(),\n  users: &#x27;users&#x27;,\n};\n  \nuser = new User(adminDB, {}, {});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3c7e206f-e7a3-4c03-a94c-fbe2c84c0e17&quot;,&quot;parentUUID&quot;:&quot;226c518f-39b2-4fff-808d-0543b7880fbb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles \&quot;after each\&quot; hook in \&quot;getAllHandles\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Restoring the stubbed functions to their original implementation\nrestore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e35f3127-b6bc-4d67-a136-0366b161118e&quot;,&quot;parentUUID&quot;:&quot;226c518f-39b2-4fff-808d-0543b7880fbb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all handles and send success response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should fetch all handles and send success response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to return user data\nconst users = [\n  { handle: &#x27;handle1&#x27; },\n  { handle: &#x27;handle2&#x27; },\n  { handle: &#x27;handle3&#x27; },\n];\nadminDB.find.returns(users);\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: true,\n  message: &#x27;All Handles&#x27;,\n  handles: [&#x27;handle1&#x27;, &#x27;handle2&#x27;, &#x27;handle3&#x27;],\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88cf5f72-c0d8-4079-8c24-42d59db788c3&quot;,&quot;parentUUID&quot;:&quot;226c518f-39b2-4fff-808d-0543b7880fbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors and send error response&quot;,&quot;fullTitle&quot;:&quot;User getAllHandles should handle errors and send error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stubbing adminDB.find to throw an error\nadminDB.find.throws(new Error(&#x27;Database error&#x27;));\n  \n// Calling the getAllHandles function\nawait user.getAllHandles(req, res);\n  \n// Assertions\nexpect(adminDB.find.calledOnceWith(adminDB.users, {})).to.be.true;\nexpect(res.send.calledOnceWith({\n  success: false,\n  message: &#x27;Error in fetching handles&#x27;,\n})).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ee8a3e0-2540-41f1-b55a-727c2c4d52f3&quot;,&quot;parentUUID&quot;:&quot;226c518f-39b2-4fff-808d-0543b7880fbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;88cf5f72-c0d8-4079-8c24-42d59db788c3&quot;,&quot;9ee8a3e0-2540-41f1-b55a-727c2c4d52f3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.2.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;custom-report&quot;,&quot;reportDir&quot;:&quot;reports&quot;,&quot;reportTitle&quot;:&quot;server&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;reports/assets&quot;,&quot;jsonFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.json&quot;,&quot;htmlFile&quot;:&quot;/home/nishant/Documents/6th sem/CS305/Final/Main Folder/server/reports/custom-report.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>